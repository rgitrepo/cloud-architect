
### **What is NEXT_HOP?**
1. **Definition**: The `NEXT_HOP` attribute in BGP (Border Gateway Protocol) tells the router which IP address should be used as the next stop to forward packets to the destination.

2. **Purpose**: It ensures that routers know the next step in the journey of a packet through the network.

3. **Key Rule**: This is a **mandatory attribute** that must always be set.

---

### **How is NEXT_HOP Determined?**
BGP determines the `NEXT_HOP` value differently depending on the type of connection (internal vs. external peers) and how far the destination is.

---



| **No.** | **Original Text** | **Explanation with Examples (Provided by You)** |
|---------|--------------------|------------------------------------------------|
| **1**   | When sending a message to an internal peer, if the route is not locally originated, the BGP speaker SHOULD NOT modify the NEXT_HOP attribute unless it has been explicitly configured to announce its own IP address as the NEXT_HOP. | **1. Internal Peer (Within the Same Network)** <br> - **Scenario**: When a router sends a route update to another router within the same organization or network. <br> **Rules**: <br> **1.1.** If the route is not **locally originated**: <br> - Do **not** change the `NEXT_HOP` unless explicitly configured to do so. <br> **Additional Explanation**: <br> If the `NEXT_HOP` was set by another router, keep it unchanged unless there’s specific configuration to override it. <br> **Example**: Router A learns a route from Router B and sends it to Router C. Router A will not modify the `NEXT_HOP` unless specifically told to. |
| **1.2** | When announcing a locally-originated route to an internal peer, the BGP speaker SHOULD use the interface address of the router through which the announced network is reachable for the speaker as the NEXT_HOP. | **1. Internal Peer (Within the Same Network)** <br> **1.2.** If the route is **locally originated**: <br> - Use the router's own interface address that is used to reach the destination as the `NEXT_HOP`. <br> **Additional Explanation**: <br> The `NEXT_HOP` should point to the announcing router itself if it originated the route. This ensures proper reachability within the network. <br> **Example**: Router A is directly connected to a network `10.0.0.0/24`. Router A announces this route to Router B and sets its own IP (e.g., `192.168.1.1`) as the `NEXT_HOP`. |
| **1.3** | If the route is directly connected to the speaker, or if the interface address of the router through which the announced network is reachable for the speaker is the internal peer's address, then the BGP speaker SHOULD use its own IP address for the NEXT_HOP attribute (the address of the interface that is used to reach the peer). | **1. Internal Peer (Within the Same Network)** <br> **1.3.** If the route is directly connected to the router or the peer's address is used to reach the network: <br> - The router sets its own IP as the `NEXT_HOP`. <br> **Additional Explanation**: <br> The `NEXT_HOP` is set to the announcing router’s interface IP, ensuring clarity in packet forwarding. This is applicable when the router is directly responsible for the destination. <br> **Example**: Router A is directly connected to `10.0.0.0/24`. Router A uses `192.168.1.1` as the `NEXT_HOP` when advertising to Router B. |
| **2**   | When sending a message to an external peer, X, and the peer is one IP hop away from the speaker: | **2. External Peer (One Hop Away)** <br> - **Scenario**: When a router sends a route update to a router outside its network. <br> **Rules**: Determine `NEXT_HOP` based on the origin of the route. |
| **2.1** | If the route being announced was learned from an internal peer or is locally originated, the BGP speaker can use an interface address of the internal peer router (or the internal router) through which the announced network is reachable for the speaker for the NEXT_HOP attribute, provided that peer X shares a common subnet with this address. | **2. External Peer (One Hop Away)** <br> **2.1.** If the route came from an internal peer or is locally originated: <br> - Use the IP of the internal peer/router, **if the external peer shares a subnet with this address**. <br> **Additional Explanation**: <br> This is called a “third-party NEXT_HOP,” where the announcing router forwards the original `NEXT_HOP` from its internal peer to the external peer. <br> **Example**: Router A (internal) learns about `10.0.0.0/24` from Router B (internal). Router A sends this route to Router C (external). If Router C shares a subnet with Router B’s address, Router A can set Router B's address as the `NEXT_HOP`. |
| **2.2** | Otherwise, if the route being announced was learned from an external peer, the speaker can use an IP address of any adjacent router (known from the received NEXT_HOP attribute) that the speaker itself uses for local route calculation in the NEXT_HOP attribute, provided that peer X shares a common subnet with this address. | **2. External Peer (One Hop Away)** <br> **2.2.** If the route came from an external peer: <br> - Use the IP of the adjacent external router, **if the external peer shares a common subnet with this address**. <br> **Additional Explanation**: <br> This is another form of “third-party NEXT_HOP.” The announcing router forwards the `NEXT_HOP` learned from one external peer to another, provided they share a subnet. <br> **Example**: Router A learns a route from External Router B (`NEXT_HOP = 172.16.0.1`). Router A advertises this route to External Router C and uses `172.16.0.1` as the `NEXT_HOP`. |
| **2.3** | Otherwise, if the external peer to which the route is being advertised shares a common subnet with one of the interfaces of the announcing BGP speaker, the speaker MAY use the IP address associated with such an interface in the NEXT_HOP attribute. | **2. External Peer (One Hop Away)** <br> **2.3.** If the external peer shares a subnet with the announcing router: <br> - Use the router’s own interface IP as the `NEXT_HOP`. <br> **Additional Explanation**: <br> This is called a “first-party NEXT_HOP,” where the announcing router points to itself as the next hop because it shares a subnet with the external peer. <br> **Example**: Router A advertises a route to Router C. Both Router A and Router C share subnet `192.168.1.0/24`. Router A can use its own IP (`192.168.1.1`) as the `NEXT_HOP`. |
| **2.4** | By default (if none of the above conditions apply), the BGP speaker SHOULD use the IP address of the interface that the speaker uses to establish the BGP connection to peer X in the NEXT_HOP attribute. | **2. External Peer (One Hop Away)** <br> **2.4.** If none of the above apply: <br> - Use the IP of the interface used to establish the BGP connection. <br> **Additional Explanation**: <br> This is the fallback case for `NEXT_HOP` when no other rules match. The announcing router simply uses its own connection interface to set the `NEXT_HOP`. <br> **Example**: Router A connects to Router C using interface `192.168.2.1`. This becomes the `NEXT_HOP`. |
| **3**   | When sending a message to an external peer X, and the peer is multiple IP hops away from the speaker (aka "multihop EBGP"): | **3. External Peer (Multiple Hops Away)** <br> - **Scenario**: When the external peer is not directly reachable (e.g., requires multiple routers). |
| **3.1** | The speaker MAY be configured to propagate the NEXT_HOP attribute. In this case, when advertising a route that the speaker learned from one of its peers, the NEXT_HOP attribute of the advertised route is exactly the same as the NEXT_HOP attribute of the learned route (the speaker does not modify the NEXT_HOP attribute). | **3. External Peer (Multiple Hops Away)** <br> **3.1.** **Propagate the NEXT_HOP**: <br> - The router does not change the `NEXT_HOP` and propagates it as it was received. <br> **Additional Explanation**: <br> This is useful for preserving routing information across multiple hops, ensuring that the original `NEXT_HOP` remains intact. <br> **Example**: Router A learns a route with `NEXT_HOP = 10.0.0.1`. Router A advertises this to Router B without modifying the `NEXT_HOP`. |
| **3.2** | By default, the BGP speaker SHOULD use the IP address of the interface that the speaker uses in the NEXT_HOP attribute to establish the BGP connection to peer X. | **3. External Peer (Multiple Hops Away)** <br> **3.2.** **Default**: <br> - Use the IP of the interface used to establish the BGP connection. <br> **Additional Explanation**: <br> If no special configuration exists, the `NEXT_HOP` defaults to the interface IP of the announcing router. |

---
